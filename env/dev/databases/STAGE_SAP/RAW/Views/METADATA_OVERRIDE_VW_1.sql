--liquibase formatted sql
				
--changeset CHANDRAMANI:METADATA_OVERRIDE_VW_1 runOnChange:true failOnError:true
--comment metadata view for creation of dynamic update logic
create or replace view METADATA_OVERRIDE_VW(
	DATASOURCE COMMENT 'Source Table Name',
	SEGMENT,
	FIELDNAME,
	POSN,
	INTTYPE,
	TYPE,
	LENGTH,
	DECIMALS,
	OUTPUTLENG,
	KEYFLAG,
	SEL_MANDATORY,
	SEL_EQUAL,
	SEL_BETWEEN,
	SEL_PATTERN,
	DELTAFIELD,
	DESCRIPTION,
	REFFIELD,
	CONVEXIT,
	LOWERCASE,
	SIGNFLAG,
	SELONLY,
	SEL_NONDEFAULT,
	TRANSFER,
	TRANSFER_NONDEFAULT,
	FIELD_TXTSH,
	FIELD_TXTMD,
	FIELD_TXTLG,
	DSRC_TYPE,
	DSRC_DELTA,
	DSRC_EXTRACTOR,
	DSRC_EXSTRUCT,
	DSRC_TXTSH,
	DSRC_TXTLG,
	DSRC_TSTPNM,
	DSRC_TSTPDAT,
	DSRC_TSTPTIM,
	INSERT_DATETIME
) COMMENT='Join METADATA_STORE_TBL and METADATA_OVERRIDE_TBL to output KEYFLAGS from both the App metadata and manual key info'
 as
SELECT
	S.DATASOURCE,
	SEGMENT,
	S.FIELDNAME,
	POSN,
	INTTYPE,
	S.TYPE,
	S.LENGTH,
	DECIMALS,
	OUTPUTLENG,
	COALESCE(O.KEYFLAG, S.KEYFLAG) KEYFLAG,
	SEL_MANDATORY,
	SEL_EQUAL,
	SEL_BETWEEN,
	SEL_PATTERN,
	DELTAFIELD,
	S.DESCRIPTION,
	REFFIELD,
	CONVEXIT,
	LOWERCASE,
	SIGNFLAG,
	SELONLY,
	SEL_NONDEFAULT,
	TRANSFER,
	TRANSFER_NONDEFAULT,
	FIELD_TXTSH,
	FIELD_TXTMD,
	FIELD_TXTLG,
	DSRC_TYPE,
	DSRC_DELTA,
	DSRC_EXTRACTOR,
	DSRC_EXSTRUCT,
	DSRC_TXTSH,
	DSRC_TXTLG,
	DSRC_TSTPNM,
	DSRC_TSTPDAT,
	DSRC_TSTPTIM,
	S.INSERT_DATETIME
FROM RAW.METADATA_STORE_TBL S
LEFT JOIN RAW.METADATA_OVERRIDE_TBL O
    ON O.DATASOURCE = S.DATASOURCE
    AND O.FIELDNAME = S.FIELDNAME;

